nav(style="background-color:#00299e").navbar.navbar-default.navbar-fixed-top
    .container-fluid
        .navbar-header
            button(type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false").navbar-toggle.collapsed
                span.sr-only Toggle navigation
                span.icon-bar
                span.icon-bar
                span.icon-bar
            a(href="/").navbar-brand
                img(alt="UFSM", src="/images/logo_pre.png" width="20px")
            a.navbar-brand(href='/opcoes')#nav-nick
        .collapse.navbar-collapse#bs-example-navbar-collapse-1
            ul.nav.navbar-nav
                li
                    a(href ="/inicial").link-planeta Inicial
                li 
                    a(href ="/mensagens").link-planeta#link-mensagens Mensagens 
                        span
                li
                    a(href ="/ranking").link-planeta#link-ranking Classificação 
                        span
                li
                    a(href="#")#link-convites Convites
                li
                    a(href ="/opcoes").link-planeta Opcoes
                li
                    a(href="#")#logout-link Logout  

#modal-convites.modal.fade(role='dialog')
    .modal-dialog
        .modal-content
            .modal-header
                button.close(type='button', data-dismiss='modal') ×
                h4.modal-title Convites
            .modal-body(style = 'overflow:scroll')
              .container-fluid
                .row
                    .col-md-12
                        .tabbable-panel
                            .tabbable-line
                                ul.nav.nav-tabs
                                    li.tab-btn
                                        a(href ="#") Pedidos de amizade
                                    li.tab-btn#tab-convites
                                        a(href ="#") Convites para aliança
                                .tab-content-convite

script.
    $("#nav-nick").html(userdata.session.nick)
    $("#link-ranking span").text("(" + userdata.rank + ")")
    $("#link-mensagens span").text("(" + userdata.caixaEntrada + ")")
    $("nav").on('click', "#logout-link", function()
    {
        $.ajax({
            url : "usuario/logout",
            method : "POST",
            success : function()
            {
                window.location.href = "/";
            },
            error : function(erro)
            {
                GerarNotificacao(erro.responseText, "danger");
            }
        });
    });

    function getPedidosDeAmizade()
    {
        
    }

    $("#link-convites").on('click', function(){
        $("#modal-convites").modal('show');
        getConvitesAlianca();
    })

    function getConvitesAlianca()
    {
        $.ajax({
            url : '/alianca/getConvites',
            method : 'GET',
            success : function(convites)
            {
                /** 
                @type {Array.<{aliancaID : number, aliancaNome : string, aliancaTag : string, mensagem : string}>}
                */
                convites
                htmlString = ""
                for(var i = 0; i <  convites.length; i++)
                {
                    var mensagemString = convites[i].mensagem.replace(/\n\s*\n/g, '\n').replace(/\n/g, '<br />');
                    htmlString += '<div class = "table-responsive"><table class = "table table-striped"><tbody>'
                        + '<tr><th>Aliança: </th><td>'+convites[i].aliancaNome+'</td></tr>'
                       // + '<tr><th colspan = "2">Mensagem: </th></tr>'
                        + '<tr><td colspan = "2">'+mensagemString+'</td></tr>'
                        + '<tr><td colspan = "2"><a href = "paginaExterna?id='+convites[i].aliancaID+'">Página da aliança</a></td></tr>'
                        + '</tbody></table><button type = "button" class = "btn btn-success btn-aceitar-convite" data-id = "'+convites[i].aliancaID+'">Aceitar</button><button type = "button" class = "btn btn-danger btn-recusar-convite" data-id = "'+convites[i].aliancaID+'">Recursar</button></div>'
                }
                $(".tab-content-convite").html(htmlString)
                $("#tab-convites").addClass('active')
                

            },
            error : function(err)
            {
                GerarNotificacao("Houve um erro para ler os convites de aliança", 'danger')
            }
        })
    }

    $(".tab-content-convite").on('click', '.btn-aceitar-convite', function()
    {
        var aliancaID = $(this).data('id');
        $.ajax({
            url : '/alianca/aceitar-convite',
            method : 'POST',
            data : {valor : 1, aliancaID : aliancaID},
            success : function()
            {
                location.reload(true)
            },
            error : function(err)
            {
                GerarNotificacao("Houve um erro ao aceitar o convite: " + err.responseText, 'danger')
            }
        })
    })

    $(".tab-content-convite").on('click', '.btn-recusar-convite', function()
    {
        var aliancaID = $(this).data('id');
        var div = $(this).parent();
        $.ajax({
            url : '/alianca/aceitar-convite',
            method : 'POST',
            data : {valor : 0, aliancaID : aliancaID},
            success : function()
            {
                div.remove()
                GerarNotificacao("Convite recusado com sucesso", 'success')
            },
            error : function(err)
            {
                GerarNotificacao("Houve um erro ao aceitar o convite: " + err.responseText, 'danger')
            }
        })
    })
