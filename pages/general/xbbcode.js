var XBBCODE=function(){"use strict";var e,t,n,r,o,a,l,s={},i=/^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;,@#%&()~_?\+=\/\\\.]*$/,c=/^(?:aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen)$/,u=/^#?[a-fA-F0-9]{6}$/,g=/[^\s@]+@[^\s@]+\.[^\s@]+/,p=/^([a-z][a-z0-9_]+|"[a-z][a-z0-9_\s]+")$/i,d=[];function f(){var s,i,c;t=[];for(s in e)if(e.hasOwnProperty(s)){for("*"===s?t.push("\\"+s):(t.push(s),e[s].noParse&&d.push(s)),e[s].validChildLookup={},e[s].validParentLookup={},e[s].restrictParentsTo=e[s].restrictParentsTo||[],e[s].restrictChildrenTo=e[s].restrictChildrenTo||[],c=e[s].restrictChildrenTo.length,i=0;i<c;i++)e[s].validChildLookup[e[s].restrictChildrenTo[i]]=!0;for(c=e[s].restrictParentsTo.length,i=0;i<c;i++)e[s].validParentLookup[e[s].restrictParentsTo[i]]=!0}n=new RegExp("<bbcl=([0-9]+) ("+t.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi"),r=new RegExp("\\[("+t.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi"),o=new RegExp("\\[("+d.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi"),function(){for(var e=[],n=0;n<t.length;n++)"\\*"!==t[n]&&e.push("/"+t[n]);a=new RegExp("(\\[)((?:"+t.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi"),l=new RegExp("(\\[)("+e.join("|")+")(\\])","gi")}()}e={b:{openTag:function(e,t){return'<span class="xbbcode-b">'},closeTag:function(e,t){return"</span>"}},bbcode:{openTag:function(e,t){return""},closeTag:function(e,t){return""}},center:{openTag:function(e,t){return'<span class="xbbcode-center">'},closeTag:function(e,t){return"</span>"}},code:{openTag:function(e,t){return'<span class="xbbcode-code">'},closeTag:function(e,t){return"</span>"},noParse:!0},color:{openTag:function(e,t){var n=(e=e||"").substr(1).toLowerCase()||"black";return c.lastIndex=0,u.lastIndex=0,c.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="black"),'<span style="color:'+n+'">'},closeTag:function(e,t){return"</span>"}},email:{openTag:function(e,t){var n;return n=e?e.substr(1):t.replace(/<.*?>/g,""),g.lastIndex=0,g.test(n)?'<a href="mailto:'+n+'">':"<a>"},closeTag:function(e,t){return"</a>"}},face:{openTag:function(e,t){var n=(e=e||"").substr(1)||"inherit";return p.lastIndex=0,p.test(n)||(n="inherit"),'<span style="font-family:'+n+'">'},closeTag:function(e,t){return"</span>"}},font:{openTag:function(e,t){var n=(e=e||"").substr(1)||"inherit";return p.lastIndex=0,p.test(n)||(n="inherit"),'<span style="font-family:'+n+'">'},closeTag:function(e,t){return"</span>"}},i:{openTag:function(e,t){return'<span class="xbbcode-i">'},closeTag:function(e,t){return"</span>"}},img:{openTag:function(e,t){var n=t;return i.lastIndex=0,i.test(n)||(n=""),'<img src="'+n+'" />'},closeTag:function(e,t){return""},displayContent:!1},justify:{openTag:function(e,t){return'<span class="xbbcode-justify">'},closeTag:function(e,t){return"</span>"}},large:{openTag:function(e,t){var n=(e=e||"").substr(1)||"inherit";return c.lastIndex=0,u.lastIndex=0,c.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="inherit"),'<span class="xbbcode-size-36" style="color:'+n+'">'},closeTag:function(e,t){return"</span>"}},left:{openTag:function(e,t){return'<span class="xbbcode-left">'},closeTag:function(e,t){return"</span>"}},li:{openTag:function(e,t){return"<li>"},closeTag:function(e,t){return"</li>"},restrictParentsTo:["list","ul","ol"]},list:{openTag:function(e,t){return"<ul>"},closeTag:function(e,t){return"</ul>"},restrictChildrenTo:["*","li"]},noparse:{openTag:function(e,t){return""},closeTag:function(e,t){return""},noParse:!0},ol:{openTag:function(e,t){return"<ol>"},closeTag:function(e,t){return"</ol>"},restrictChildrenTo:["*","li"]},php:{openTag:function(e,t){return'<span class="xbbcode-code">'},closeTag:function(e,t){return"</span>"},noParse:!0},quote:{openTag:function(e,t){return'<blockquote class="xbbcode-blockquote">'},closeTag:function(e,t){return"</blockquote>"}},right:{openTag:function(e,t){return'<span class="xbbcode-right">'},closeTag:function(e,t){return"</span>"}},s:{openTag:function(e,t){return'<span class="xbbcode-s">'},closeTag:function(e,t){return"</span>"}},size:{openTag:function(e,t){e=e||"";var n=parseInt(e.substr(1),10)||0;return(n<4||n>40)&&(n=14),'<span class="xbbcode-size-'+n+'">'},closeTag:function(e,t){return"</span>"}},small:{openTag:function(e,t){var n=(e=e||"").substr(1)||"inherit";return c.lastIndex=0,u.lastIndex=0,c.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="inherit"),'<span class="xbbcode-size-10" style="color:'+n+'">'},closeTag:function(e,t){return"</span>"}},sub:{openTag:function(e,t){return"<sub>"},closeTag:function(e,t){return"</sub>"}},sup:{openTag:function(e,t){return"<sup>"},closeTag:function(e,t){return"</sup>"}},table:{openTag:function(e,t){return'<table class="xbbcode-table">'},closeTag:function(e,t){return"</table>"},restrictChildrenTo:["tbody","thead","tfoot","tr"]},tbody:{openTag:function(e,t){return"<tbody>"},closeTag:function(e,t){return"</tbody>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},tfoot:{openTag:function(e,t){return"<tfoot>"},closeTag:function(e,t){return"</tfoot>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},thead:{openTag:function(e,t){return'<thead class="xbbcode-thead">'},closeTag:function(e,t){return"</thead>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},td:{openTag:function(e,t){return'<td class="xbbcode-td">'},closeTag:function(e,t){return"</td>"},restrictParentsTo:["tr"]},th:{openTag:function(e,t){return'<th class="xbbcode-th">'},closeTag:function(e,t){return"</th>"},restrictParentsTo:["tr"]},tr:{openTag:function(e,t){return'<tr class="xbbcode-tr">'},closeTag:function(e,t){return"</tr>"},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},u:{openTag:function(e,t){return'<span class="xbbcode-u">'},closeTag:function(e,t){return"</span>"}},ul:{openTag:function(e,t){return"<ul>"},closeTag:function(e,t){return"</ul>"},restrictChildrenTo:["*","li"]},url:{openTag:function(e,t){var n;return n=e?e.substr(1):t.replace(/<.*?>/g,""),i.lastIndex=0,i.test(n)||(n="#"),'<a href="'+n+'">'},closeTag:function(e,t){return"</a>"}},"*":{openTag:function(e,t){return"<li>"},closeTag:function(e,t){return"</li>"},restrictParentsTo:["list","ul","ol"]}},f();var b=function(t,r,o,a,l){o=o.toLowerCase();var s=e[o].noParse?l.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;"):l.replace(n,b),i=e[o].openTag(a,s),c=e[o].closeTag(a,s);return!1===e[o].displayContent&&(s=""),i+s+c};return s.tags=function(){return e},s.addTags=function(t){var n;for(n in t)e[n]=t[n];f()},s.process=function(s){var i={html:"",error:!1},c=[];for(s.text=s.text.replace(/</g,"&lt;"),s.text=s.text.replace(/>/g,"&gt;"),s.text=s.text.replace(a,function(e,t,n,r){return"<"+n+">"}),s.text=s.text.replace(l,function(e,t,n,r){return"<"+n+">"}),s.text=s.text.replace(/\[/g,"&#91;"),s.text=s.text.replace(/\]/g,"&#93;"),s.text=s.text.replace(/</g,"["),s.text=s.text.replace(/>/g,"]");s.text!==(s.text=s.text.replace(o,function(e,t,n,r){return r=(r=r.replace(/\[/g,"&#91;")).replace(/\]/g,"&#93;"),"["+t+(n=n||"")+"]"+(r=r||"")+"[/"+t+"]"})););return s.text=function(e){for(e=(e=e.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/gi,"<")).replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/gi,">");e!==(e=e.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(e,t,n){for(var r=e;r!==(r=r.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(e,t,n){return"<*]"+t+(n=">/list]"===n.toLowerCase()?"</*]</list]":"</*][*]")})););return r=r.replace(/>/g,"<")})););return e=e.replace(/</g,"[")}(s.text),s.text=function(e){for(;e!==(e=e.replace(r,function(e,t,n,r){return(e=(e=e.replace(/\[/g,"<")).replace(/\]/g,">")).replace(/\<([^\>][^\>]*?)\>/gi,function(e,t){return null===t.match(/^bbcl=([0-9]+) /)?"<bbcl=0 "+t+">":"<"+t.replace(/^(bbcl=)([0-9]+)/,function(e,t,n){return t+(parseInt(n,10)+1)})+">"})})););return e}(s.text),c=function r(o,a,l,s,i,c,u){u=u||[],l++;var g,p,d,f,b=new RegExp("(<bbcl="+l+" )("+t.join("|")+")([ =>])","gi"),h=new RegExp("(<bbcl="+l+" )("+t.join("|")+")([ =>])","i"),T=c.match(b)||[],m=e[o]||{};for(b.lastIndex=0,T||(c=""),d=0;d<T.length;d++)h.lastIndex=0,f=T[d].match(h)[2].toLowerCase(),m&&m.restrictChildrenTo&&m.restrictChildrenTo.length>0&&(m.validChildLookup[f]||(p='The tag "'+f+'" is not allowed as a child of the tag "'+o+'".',u.push(p))),(g=e[f]||{}).restrictParentsTo.length>0&&(g.validParentLookup[o]||(p='The tag "'+o+'" is not allowed as a parent of the tag "'+f+'".',u.push(p)));return c=c.replace(n,function(e,t,n,o,a){return u=r(n.toLowerCase(),e,t,n,o,a,u),e}),u}("bbcode",s.text,-1,0,0,s.text),i.html=s.text.replace(n,b),-1===i.html.indexOf("[")&&-1===i.html.indexOf("]")||c.push("Some tags appear to be misaligned."),s.removeMisalignedTags&&(i.html=i.html.replace(/\[.*?\]/g,"")),s.addInLineBreaks&&(i.html='<div style="white-space:pre-wrap;">'+i.html+"</div>"),s.escapeHtml||(i.html=i.html.replace("&#91;","["),i.html=i.html.replace("&#93;","]")),i.error=0!==c.length,i.errorQueue=c,i},s}();"undefined"!=typeof module&&(module.exports=XBBCODE);